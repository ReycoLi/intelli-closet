# Intelli Closet 智能衣橱 — 产品需求文档（PRD）

## 1. 产品背景

用户（目标用户画像：有大量衣物的都市人群）每天出门前面临"穿什么"的选择困难。衣柜里衣物种类繁多，凭记忆难以高效搭配，尤其需要考虑天气、场合、颜色协调、风格匹配等多维因素。

Intelli Closet 是一款 iOS 原生 App，核心价值是：
- 用 AI 自动识别和管理衣物属性
- 根据天气 + 场合 + 视觉美感，智能推荐搭配方案
- 让用户从"每天纠结穿什么"变成"看推荐选一套"

## 2. 用户场景

| 场景 | 描述 |
|------|------|
| 新衣入库 | 买了新衣服，拍照上传，AI 自动识别所有属性，用户审核确认后入库 |
| 批量录入 | 第一次使用，需要把衣柜里的衣服批量拍照录入（最多 5 张一批） |
| 日常穿搭 | 出门前选择场合，App 获取天气，推荐 1-3 套搭配并给出理由 |
| 衣物管理 | 浏览衣橱，查看/编辑衣物属性，删除不再穿的衣物 |

## 3. 功能需求

### 3.1 衣物拍照上传与 AI 分析

**单件上传（拍照）：**
- 调用系统相机拍照
- AI 自动识别以下属性：
  - 名称：为每件衣物起一个独特、有美感的中文名称
  - 分类：上装 / 下装
  - 子分类：T恤、衬衫、卫衣、牛仔裤、西裤等
  - 主要颜色 / 次要颜色
  - 材质
  - 保暖等级（1-5 级，对应轻薄→厚实，关联温度范围）
  - 风格标签：休闲、通勤、街头、正式等（多选）
  - 版型：宽松、修身、标准等
  - AI 描述：自然语言描述质感、细节、搭配方向
- 照片质量校验：模糊、不完整、杂乱无法识别时，提示用户重新拍照
- 识别完成后进入编辑页，用户可修改任何字段后保存

**批量上传（相册）：**
- 从系统相册多选，单次最多 5 张
- 并行调用 AI 分析（5 张同时分析）
- 分析过程中展示每张照片的进度状态（分析中 / 成功 / 失败）
- 基于缩略图 SHA256 哈希的重复检测，已存在的衣物自动标记跳过
- 分析完成后进入逐件审核模式：
  - 左右滑动切换不同衣物
  - 每件衣物展示完整编辑表单（与单件上传一致）
  - 支持逐件保存或跳过
  - 顶部进度点指示当前审核进度
  - 全部审核完成后显示保存汇总

### 3.2 衣橱浏览与管理

- 网格布局展示所有衣物缩略图
- 按分类筛选（全部 / 上装 / 下装）
- 搜索：支持按名称、颜色、风格标签搜索
- 按添加时间倒序排列（最新在前）
- 点击进入详情页：
  - 展示完整照片和所有属性
  - 保暖等级显示为友好标签（如"轻薄"而非数字）
  - 支持编辑所有属性
  - 支持删除（二次确认）

### 3.3 智能穿搭推荐

**场合选择：**
- 预设场合：上班、逛街、参加 party、遛狗、约会、运动（2 列网格布局）
- 支持用户自定义输入场合
- 可选推荐套数：1-3 套（默认 2 套）

**推荐流程（三阶段）：**

第一阶段 — 天气获取：
- 优先通过 iOS 定位获取经纬度，调用天气 API 获取实时天气
- 定位失败时，支持用户手动输入城市名
- 城市查询失败时，支持用户直接输入温度和天气状况

第二阶段 — 本地预筛选：
- 根据温度过滤保暖等级不匹配的衣物
- 根据场合过滤风格标签不匹配的衣物（场合-风格映射表）
- 风格过滤过于激进时（候选 < 6 件），自动回退到仅温度过滤
- 筛选透明化：
  - 展示筛选条件（如"当前 5°C，需要保暖/厚实的衣物（等级 3-5）"）
  - 展示每件被过滤衣物的具体原因
  - 候选不足时（上装或下装 < 3 件），在错误页展示完整筛选详情

第三阶段 — AI 推荐：
- 文本预选：AI 从候选衣物中挑选最适合的单品（流式输出）
- 多模态推荐：将预选衣物的照片发送给视觉 AI，基于视觉美感生成搭配方案（流式输出）
- 推荐过程中展示动态提示动画（颜色搭配、风格协调、天气选择、场合适配等）

**推荐结果展示：**
- 每套搭配展示上装和下装的照片
- 结构化推荐理由（每项 ≤ 20 字，精炼有用）：
  - 颜色搭配：什么色配什么色、为什么好看
  - 风格协调：版型/风格为什么搭
  - 天气适配：结合实际温度说明
  - 场合匹配：为什么适合该场合
  - 整体美感：氛围气质描述（≤ 25 字，独立卡片展示）
  - 核心亮点：一句话总结（≤ 15 字）
- 多套推荐结果左右滑动切换

### 3.4 用户资料

- 身高、体重（数字输入）
- 大头照、全身照（相册选择）
- 数据本地持久化

### 3.5 保暖等级体系

保暖等级是连接衣物属性和天气筛选的核心概念，需要对用户友好：

| 等级 | 标签 | 适用温度 | 典型衣物 |
|------|------|----------|----------|
| 1 | 轻薄 | 28°C 以上 | 背心、短袖T恤 |
| 2 | 透气 | 20-28°C | 衬衫、薄外套 |
| 3 | 适中 | 15-22°C | 卫衣、薄毛衣 |
| 4 | 保暖 | 8-15°C | 厚毛衣、夹克 |
| 5 | 厚实 | 8°C 以下 | 羽绒服、大衣 |

- 所有涉及保暖等级的 UI 均显示标签而非数字
- 选择器下方展示温度范围和典型衣物示例
- 筛选详情中使用"当前 X°C，需要 XX 的衣物"的友好描述

## 4. 非功能需求

### 4.1 UI/UX
- 整体风格：清新、简洁，主色调 Mint
- 中文界面
- 推荐过程中有动态提示和动画，体现智能感
- 键盘处理：数字键盘支持"完成"按钮收起

### 4.2 性能
- AI 分析使用流式输出，实时展示进度
- 批量上传并行分析，不阻塞 UI
- 图片压缩后上传，缩略图单独存储用于列表展示

### 4.3 数据存储
- 本地优先：SwiftData 持久化，无服务端数据库
- 图片使用 External Storage 存储
- 单用户模式，无需登录

## 5. 技术架构

### 5.1 技术栈
- Swift 6 / SwiftUI
- SwiftData（本地持久化）
- 阿里云百炼 DashScope API（AI 服务）
- Open-Meteo API（天气数据，免费无需 key）
- CryptoKit（SHA256 图片去重）
- CoreLocation（定位）

### 5.2 AI 模型选用
- 衣物识别：qwen-vl-max（多模态视觉理解）
- 文本预选：qwen3.5-plus（文本推理）
- 多模态推荐：qwen-vl-max（视觉搭配分析）
- 原则：效果优先，不考虑成本

### 5.3 API 配置
- Base URL: `https://dashscope.aliyuncs.com/compatible-mode/v1`
- API Key 通过 `Secrets.swift` 管理（gitignore，不入库）
- 提供 `Secrets.example` 模板

### 5.4 项目结构
```
intelli-closet/
├── Models/              # 数据模型（ClothingItem, UserProfile, WarmthLevel 等）
├── Services/            # 服务层（AliyunService, WeatherService, LocalFilterService）
├── ViewModels/          # 视图模型（MVVM 架构）
├── Views/
│   ├── AddClothing/     # 添加衣物流程（拍照/批量/编辑/审核）
│   ├── Recommend/       # 智能推荐流程（场合选择/进度/结果）
│   ├── Wardrobe/        # 衣橱浏览（列表/详情/编辑）
│   ├── Profile/         # 用户资料
│   └── MainTabView.swift
└── Utilities/           # 工具类（图片压缩/缩略图）
```

## 6. MVP 范围与限制

当前 MVP 版本：
- 仅支持上装和下装，暂不支持鞋帽首饰
- 单用户模式，无需登录注册
- 无日志打点、监控、历史记录
- 无用户偏好学习和反馈系统
- 无试穿预览/效果图生成（用户资料已预留字段，后续迭代）
- 无服务端，纯本地 + AI API 调用

## 7. 后续迭代方向（未实现）

- 试穿效果预览：基于用户身高体重和照片，AI 生成试穿效果图
- 更多衣物类型：鞋子、帽子、配饰等
- 搭配历史记录：记录每天穿了什么
- 用户偏好学习：根据用户选择/拒绝的推荐，优化后续推荐
- 评估反馈系统：用户对推荐结果打分
- 多用户支持
- 衣橱数据云同步
